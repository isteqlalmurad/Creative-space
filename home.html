<html>

<head>
    
    <title>Creative Space - Accessible Inspiration</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');

        :root {
            --primary-color: rgba(255, 255, 255, 0.7);
            --secondary-color: rgba(200, 200, 200, 0.3);
            --accent-color: #4CAF50;
            --text-color: #333;
            --background-color: #f0f0f0;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            font-size: 16px;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100%;
            width: 100%;
            box-sizing: border-box;
            position: relative;
            padding: 20px;
        }

        .chat-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--primary-color);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            min-width: 300px;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .chat-window {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--secondary-color);
        }

        .input-area {
            display: flex;
            padding: 15px;
            background: var(--primary-color);
        }

        #user-input {
            flex-grow: 1;
            padding: 12px 20px;
            border: 2px solid var(--accent-color);
            border-radius: 30px;
            font-size: 16px;
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        #user-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.3);
        }

        #send-button {
            margin-left: 10px;
            padding: 12px 25px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        #send-button:hover,
        #send-button:focus {
            background-color: #45a049;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.3);
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 15px;
            max-width: 80%;
            background: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .user-message {
            align-self: flex-end;
            margin-left: auto;
            background-color: var(--accent-color);
            color: white;
        }

        .bot-message,
        .comment-message {
            align-self: flex-start;
        }

        .bot-message h1,
        .bot-message h2,
        .bot-message h3,
        .bot-message h4,
        .bot-message h5,
        .bot-message h6,
        .comment-message h1,
        .comment-message h2,
        .comment-message h3,
        .comment-message h4,
        .comment-message h5,
        .comment-message h6 {
            margin-top: 10px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .bot-message h1,
        .comment-message h1 {
            font-size: 1.8em;
        }

        .bot-message h2,
        .comment-message h2 {
            font-size: 1.6em;
        }

        .bot-message h3,
        .comment-message h3 {
            font-size: 1.4em;
        }

        .bot-message h4,
        .comment-message h4 {
            font-size: 1.2em;
        }

        .bot-message h5,
        .comment-message h5 {
            font-size: 1.1em;
        }

        .bot-message h6,
        .comment-message h6 {
            font-size: 1em;
        }

        .bot-message ul,
        .bot-message ol,
        .comment-message ul,
        .comment-message ol {
            padding-left: 20px;
            margin: 10px 0;
        }

        .bot-message li,
        .comment-message li {
            margin-bottom: 5px;
        }

        h2 {
            font-weight: 700;
            font-size: 24px;
            margin: 15px;
            color: var(--text-color);
        }

        /* Accessibility Improvements */
        *:focus {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :root {
                --primary-color: white;
                --secondary-color: #f0f0f0;
                --accent-color: #006400;
                --text-color: black;
                --background-color: white;
            }

            .message,
            .chat-column,
            .input-area {
                border: 1px solid black;
            }
        }

        /* Dark Mode */
        @media (prefers-color-scheme: dark) {
            :root {
                --primary-color: rgba(50, 50, 50, 0.7);
                --secondary-color: rgba(30, 30, 30, 0.3);
                --accent-color: #6ECF71;
                --text-color: #f0f0f0;
                --background-color: #121212;
            }

            #user-input {
                background-color: rgba(0, 0, 0, 0.6);
                color: var(--text-color);
            }
        }

        /* Dyslexia-friendly option */
        .dyslexic-font {
            font-family: 'OpenDyslexic', 'Comic Sans MS', 'Verdana', sans-serif;
            font-size: 18px;
            letter-spacing: 0.2px;
            word-spacing: 0.3em;
        }

        /* Resizable columns */
        .resizer {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 10px;
            background: rgba(0, 0, 0, 0.1);
            cursor: col-resize;
            z-index: 100;
        }

        #idea-resizer {
            right: -5px;
        }

        #insight-resizer {
            left: -5px;
        }

        .resizer:hover,
        .resizer:active {
            background: rgba(0, 0, 0, 0.3);
        }

        .typing-indicator {
            display: inline-block;
            width: 30px;
            height: 15px;
        }

        .typing-indicator span {
            display: inline-block;
            width: 5px;
            height: 5px;
            background-color: var(--accent-color);
            border-radius: 50%;
            animation: typing 1s infinite ease-in-out;
            margin: 0 2px;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }

            100% {
                transform: translateY(0);
            }
        }

        .search-result {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }

        .search-result h3 {
            margin-top: 0;
            color: var(--accent-color);
        }

        .search-result a {
            color: #007bff;
            text-decoration: none;
        }

        .search-result a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="chat-column" id="idea-incubator">
            <h2>Idea Incubator</h2>
            <div id="chat-window" class="chat-window"></div>
            <div class="input-area">
                <input type="text" id="user-input" placeholder="Share your creative spark..."
                    aria-label="Enter your message">
                <button id="send-button">Send</button>
            </div>
            <div class="resizer" id="idea-resizer"></div>
        </div>
        <div class="chat-column" id="insight-mirror">
            <h2>Insight Mirror</h2>
            <div id="comment-window" class="chat-window"></div>
            <!-- <div class="resizer" id="insight-resizer"></div> -->
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>
    <script>
        $(document).ready(function () {
            const chatWindow = $('#chat-window');
            const commentWindow = $('#comment-window');
            const userInput = $('#user-input');
            const sendButton = $('#send-button');
            const ideaIncubator = $('#idea-incubator');
            const insightMirror = $('#insight-mirror');
            const ideaResizer = $('#idea-resizer');
            const insightResizer = $('#insight-resizer');
            const container = $('.container');



            const firt = 'sk-proj-4aFay7rxH7a-XmFjZ5QNwprFoh96Y'
            const second = 'C5pKhIW-lRE8VOJQhXANpZsDS5JsEFEupAhBiXdV8hvGLT3B'
            const third = 'lbkFJHVQbpm07E8Z-KX-XcuI6JryNicqm08xSIyYFZHcEnkt__ZsTzD_cjKVcYbiJEuT5FL5moerpsA'

            const apiKey = firt + second + third
            const apiUrl = 'https://api.openai.com/v1/chat/completions';
            const ideaAssistantId = 'asst_XaAeQWuIFTYv99SBgNAG25xc';
            const insightAssistantId = 'asst_14R5zo2DPjK23IB9nGTWN1Za';

            const converter = new showdown.Converter();

            let ideaThreadId = null;
            let insightThreadId = null;

            function addMessage(message, type) {
                const messageElement = $('<div>').addClass('message').addClass(type);
                if (type === 'bot-message' || type === 'comment-message') {
                    messageElement.html(converter.makeHtml(message));
                } else {
                    messageElement.text(message);
                }
                chatWindow.append(messageElement);
                chatWindow.scrollTop(chatWindow[0].scrollHeight);
                return messageElement;
            }

            function addComment(comment) {
                const commentElement = $('<div>').addClass('message').addClass('comment-message');
                commentElement.html(converter.makeHtml(comment));
                commentWindow.append(commentElement);
                commentWindow.scrollTop(commentWindow[0].scrollHeight);
                return commentElement;
            }

            function addTypingIndicator(element) {
                const indicator = $('<div>').addClass('typing-indicator');
                for (let i = 0; i < 3; i++) {
                    indicator.append($('<span>'));
                }
                element.append(indicator);
            }

            function removeTypingIndicator(element) {
                element.find('.typing-indicator').remove();
            }

            async function createThread() {
                const response = await axios.post('https://api.openai.com/v1/threads', {}, {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'OpenAI-Beta': 'assistants=v1'
                    }
                });
                return response.data.id;
            }

            async function addMessageToThread(threadId, message) {
                await axios.post(`https://api.openai.com/v1/threads/${threadId}/messages`, {
                    role: 'user',
                    content: message
                }, {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'OpenAI-Beta': 'assistants=v1'
                    }
                });
            }

            async function runAssistant(threadId, assistantId) {
                const runResponse = await axios.post(`https://api.openai.com/v1/threads/${threadId}/runs`, {
                    assistant_id: assistantId
                }, {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'OpenAI-Beta': 'assistants=v1'
                    }
                });

                let runId = runResponse.data.id;
                let runStatus = runResponse.data.status;

                while (runStatus !== 'completed') {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    const statusResponse = await axios.get(`https://api.openai.com/v1/threads/${threadId}/runs/${runId}`, {
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'OpenAI-Beta': 'assistants=v1'
                        }
                    });
                    runStatus = statusResponse.data.status;
                }

                const messagesResponse = await axios.get(`https://api.openai.com/v1/threads/${threadId}/messages`, {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'OpenAI-Beta': 'assistants=v1'
                    }
                });

                return messagesResponse.data.data[0].content[0].text.value;
            }

            async function chatbotResponse(message) {
                const messageElement = addMessage("", 'bot-message');
                addTypingIndicator(messageElement);

                if (!ideaThreadId) {
                    ideaThreadId = await createThread();
                }

                await addMessageToThread(ideaThreadId, message);
                const response = await runAssistant(ideaThreadId, ideaAssistantId);

                removeTypingIndicator(messageElement);
                messageElement.html(converter.makeHtml(response));
                chatWindow.scrollTop(chatWindow[0].scrollHeight);

                return response;  // Return the response for the Insight Mirror
            }

            async function performInternetSearch(query) {
                const searchUrl = `https://api.bing.microsoft.com/v7.0/search?q=${encodeURIComponent(query)}`;
                try {
                    const response = await axios.get(searchUrl, {
                        headers: {
                            'Ocp-Apim-Subscription-Key': 'YOUR_BING_SEARCH_API_KEY'
                        }
                    });
                    return response.data.webPages.value.slice(0, 3);  // Return top 3 results
                } catch (error) {
                    console.error('Error performing internet search:', error);
                    return [];
                }
            }

            function formatSearchResults(results) {
                if (results.length === 0) return "";

                let formattedResults = "### Relevant Resources:\n\n";
                results.forEach((result, index) => {
                    formattedResults += `${index + 1}. [${result.name}](${result.url})\n   ${result.snippet}\n\n`;
                });
                return formattedResults;
            }

            async function commentBotResponse(message, ideaResponse) {
                const commentElement = addComment("");
                addTypingIndicator(commentElement);

                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: "gpt-4",
                            messages: [
                                {
                                    role: "system",
                                    content: `Spike's job is to think laterally. Spike is at a slight angle to the universe. Spike is the voice in the corner of the room that has a surreal take on things. The way Spike thinks and talks is a combination of Spike Milligan and Peter Cook with the creative perfomative inclinations of Peter Sellers.

In interactions Spike attempts to look for opportunities in problems and presents alternative ways of looking at the problem or situation. Spike's job isn't necessarily to solve a problem, just to force another perspective on it and try to present it in a way that isn't typical or perhaps hasn't been done before.

In practice, Spike employs the following tools in the following order before giving any response:

1) Ask “Why?” repeatedly to drill down into the root cause of the problem. This technique helps in uncovering underlying issues and potential solutions.

2) Use analogies or metaphors to relate the problem to a different context. For example, comparing a business challenge to a sports game can reveal new strategies and perspectives.

3) List all the assumptions related to the problem and challenge each one. Ask, “What if this assumption is false?” This can open up new ways of thinking about the problem.

4) Brainstorm ideas by taking on different roles or personas. For example, think about how a child, an artist, or a scientist would approach the problem. This can help break out of conventional thinking patterns.

5) SCAMPER method:
 • Substitute: What can be substituted?
 • Combine: What can be combined?
 • Adapt: What small detail can be changed to reframe the problem?
 • Modify: What can be modified or magnified?
 • Put to another use: Is this problem a good thing for anyone or anything?
 • Eliminate: What isn't important about the problem?
 • Reverse/Rearrange: What does the opposite look like?

6) Make provocative and seemingly absurd statements about the problem. For example, “What if we did the opposite of what we currently do?” This can help break down entrenched thinking patterns and generate novel ideas.

7) A way of thinking where you look at a problem from the perspective of making your competition’s strengths irrelevant. This involves creative and often counterintuitive strategies to disrupt and reframe challenges.

The above stages are not presented to the user, they are just the steps Spike takes to evaluate the problem.

Spike will deliver a succinct response in 300 characters or less. Only if asked will Spike provide more in-depth strategy.`
                                },
                                {
                                    role: "user",
                                    content: `User's idea: ${message}\n\nIdea Incubator's response: ${ideaResponse}\n\nProvide insights and comments on this interaction using the specified techniques.`
                                }
                            ],
                            stream: true
                        })
                    });

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let accumulatedResponse = '';

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;

                        const chunk = decoder.decode(value);
                        const lines = chunk.split('\n');
                        const parsedLines = lines
                            .map(line => line.replace(/^data: /, '').trim())
                            .filter(line => line !== '' && line !== '[DONE]')
                            .map(line => {
                                try {
                                    return JSON.parse(line);
                                } catch (e) {
                                    console.error('Error parsing JSON:', e, line);
                                    return null;
                                }
                            })
                            .filter(line => line !== null);

                        for (const parsedLine of parsedLines) {
                            if (parsedLine.choices[0].delta.content) {
                                accumulatedResponse += parsedLine.choices[0].delta.content;
                                commentElement.html(converter.makeHtml(accumulatedResponse));
                                commentWindow.scrollTop(commentWindow[0].scrollHeight);
                            }
                        }
                    }

                    // Perform internet search after AI response
                    const searchQuery = `${message} ${ideaResponse}`.substring(0, 150);  // Limit query length
                    const searchResults = await performInternetSearch(searchQuery);
                    const formattedResults = formatSearchResults(searchResults);

                    // Append search results to the accumulated response
                    accumulatedResponse += '\n\n' + formattedResults;
                    commentElement.html(converter.makeHtml(accumulatedResponse));
                    commentWindow.scrollTop(commentWindow[0].scrollHeight);

                    removeTypingIndicator(commentElement);
                } catch (error) {
                    console.error('Error:', error);
                    removeTypingIndicator(commentElement);
                    commentElement.html("Sorry, there was an error generating insights. Please try again.");
                }
            }

            sendButton.click(async function () {
                const message = userInput.val().trim();
                if (message) {
                    addMessage(message, 'user-message');
                    userInput.val('');

                    const ideaResponse = await chatbotResponse(message);
                    await commentBotResponse(message, ideaResponse);
                }
            });

            userInput.keypress(function (e) {
                if (e.which == 13) {
                    sendButton.click();
                }
            });

            // Accessibility feature: Toggle dyslexia-friendly font
            $('body').append('<button id="toggle-font" style="position:fixed;top:10px;right:10px;z-index:1000;">Toggle Font</button>');
            $('#toggle-font').click(function () {
                $('body').toggleClass('dyslexic-font');
            });

            // Resizable and dynamic columns functionality
            let isResizing = false;
            let currentResizer = null;

            function updateColumnsSize(e) {
                const containerWidth = container.width();
                const minWidth = 300;
                const maxWidth = containerWidth - minWidth - 40; // 40px for padding

                if (currentResizer.attr('id') === 'idea-resizer') {
                    let newWidth = e.clientX - ideaIncubator.offset().left;
                    newWidth = Math.max(minWidth, Math.min(newWidth, maxWidth));
                    ideaIncubator.css('flex', `0 0 ${newWidth}px`);
                    insightMirror.css('flex', `1 1 auto`);
                } else {
                    let newWidth = containerWidth - e.clientX + insightMirror.offset().left - 40;
                    newWidth = Math.max(minWidth, Math.min(newWidth, maxWidth));
                    insightMirror.css('flex', `0 0 ${newWidth}px`);
                    ideaIncubator.css('flex', `1 1 auto`);
                }
            }

            function handleMouseDown(e) {
                isResizing = true;
                currentResizer = $(e.target);
                $('body').css('user-select', 'none');
            }

            function handleMouseMove(e) {
                if (!isResizing) return;
                updateColumnsSize(e);
            }

            function handleMouseUp() {
                isResizing = false;
                currentResizer = null;
                $('body').css('user-select', 'auto');
            }

            ideaResizer.on('mousedown', handleMouseDown);
            insightResizer.on('mousedown', handleMouseDown);
            $(document).on('mousemove', handleMouseMove);
            $(document).on('mouseup', handleMouseUp);

            // Handle window resize
            $(window).on('resize', function () {
                const containerWidth = container.width();
                const ideaWidth = ideaIncubator.width();
                const insightWidth = insightMirror.width();
                const totalWidth = ideaWidth + insightWidth;

                ideaIncubator.css('flex', `0 0 ${(ideaWidth / totalWidth * 100)}%`);
                insightMirror.css('flex', `0 0 ${(insightWidth / totalWidth * 100)}%`);
            });

            addMessage("# Hi there!\n\n Welcome to Creative Space I'm your Creative Director, here to guide you through a briefing process for your project. ", 'bot-message');
            addComment("use this window as a reflection mirror it will guide, inspire and critique your ideas.");
        });
    </script>
</body>

</html>
